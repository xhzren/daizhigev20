# 殆知阁古代文献在线检阅（Node 版）

这是一个基于 Node.js + Express + EJS 的最小可运行网站，用于在本仓库中文本资料基础上进行在线浏览。

当前目标：提供基础框架与运行环境，支持按分类（如“儒藏”“史藏”等）浏览目录与打开 `.txt` 文本进行在线阅读。

## 运行环境

- Node.js >= 16
- 不需要数据库

## 安装与运行

```bash
# 安装依赖
npm install

# 开发模式（带热重载）
npm run dev

# 或以生产模式启动
npm start
```

启动后访问：http://localhost:3000

如需自定义内容根目录（默认即是本仓库根目录），可通过环境变量指定：

```bash
CONTENT_ROOT=/path/to/daizhige npm start
```

## 功能说明（当前）

- 首页：展示已识别的“十类藏书”目录列表
- 目录页：进入某一类后，可逐级浏览子目录与 `.txt` 文件
- 文本页：以页面内嵌的形式渲染 `.txt` 文本内容

> 注意：部分文本较大，首次渲染可能需要一定时间；目前未做分页/分块渲染。

## 后续设计建议（Roadmap）

1. 检索能力
   - 站内全文检索：基于小型索引（如 Lunr.js/mini-search）或后端分词（Node + 结巴/Nodejieba）
   - 标题与文件名联想搜索（即时提示）
   - 搜索范围限定（按分类/目录限定）

2. 性能与可用性
   - 大文本分页/分块读取（流式传输 + 前端虚拟列表）
   - 生成静态索引（离线任务），避免每次目录递归带来的开销
   - 基于 `etag/last-modified` 的缓存与 CDN 支持

3. 阅读体验
   - 主题切换（明/暗）
   - 字体与字号可配置（适合古文阅读的衬线字体）
   - 行间距、版心、边注/批注区域
   - 章节导航、页内目录（根据约定的章节标记自动生成 TOC）

4. 元数据与标注
   - 补充作品元数据（作者、朝代、版本来源）以提升检索与导航体验
   - 支持用户高亮、批注（本地存储起步，后期可接入后端）

5. 结构化整理
   - 针对单个大文件的“三级拆分”，按章/节自动切分（正则 + 规则库），提升检索与阅读效率
   - 统一命名与路径规范（避免同名冲突）

6. 国际化与可访问性
   - zh-CN/zh-TW/英文 UI 切换
   - 无障碍特性（语义化 HTML、可键盘操作、ARIA 标签）

7. 部署方案
   - 传统 Node 进程（PM2）或容器化（Docker）
   - 静态资源前置到 CDN，应用层反向代理（Nginx/Caddy）

## 目录结构（新增）

```
/ (仓库根目录，亦为默认的 CONTENT_ROOT)
├─ src/server.js        # Express 程序入口
├─ views/               # EJS 视图模板
├─ public/styles.css    # 简易样式
├─ package.json         # 依赖与脚本
└─ .gitignore           # 忽略文件
```

## 已识别分类

- 儒藏 / 史藏 / 子藏 / 集藏 / 艺藏 / 道藏 / 易藏 / 诗藏 / 佛藏 / 医藏

如需扩展，可在 `src/server.js` 中调整 `VALID_CATEGORIES`。

## 版权声明

本项目基于开源资料，仅用于学习研究。若涉及权利问题，请提交 Issue 或联系维护者，我们将及时处理。
